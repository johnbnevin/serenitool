<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reframing Resentments</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        input, select, textarea {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: var(--accent);
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        .worksheet-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .methodology-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .methodology-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
        }

        .tab-container {
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            background: var(--light);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: var(--secondary);
            color: white;
            box-shadow: 0 2px 10px rgba(52, 152, 219, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--primary);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .entry-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .entry-card:hover {
            border-color: var(--secondary);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .entry-title {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .entry-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .entry-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-label {
            font-weight: 600;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .detail-value {
            color: var(--dark);
        }

        .affects-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .tag {
            background: var(--secondary);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .progress-indicator {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .progress-bar {
            background: var(--light);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--success), var(--secondary));
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--dark);
        }

        .prayer-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .prayer-text {
            font-style: italic;
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .export-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .export-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: black;
        }

        .privacy-notice {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .privacy-notice h4 {
            color: #155724;
            margin-bottom: 10px;
        }

        .privacy-notice p {
            color: #155724;
            font-size: 0.9rem;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        .smart-principles {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .smart-principles h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .smart-principles ul {
            list-style: none;
            padding-left: 0;
        }

        .smart-principles li {
            background: #fff;
            margin: 5px 0;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 4px solid var(--warning);
        }

        .affects-definitions {
            margin-top: 15px;
        }

        .affect-item {
            background: #f8f9fa;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 6px;
            border-left: 3px solid var(--secondary);
            font-size: 0.9rem;
        }

        .affect-item strong {
            color: var(--primary);
        }

        .amends-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .amends-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .amends-complete {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .amends-na {
            background: #e2e3e5;
            color: #495057;
            border: 1px solid #ced4da;
        }

        .quote-section {
            margin: 15px 0;
            padding: 12px;
            background: #f8f9fa;
            border-left: 4px solid var(--secondary);
            border-radius: 6px;
        }

        .quote-section blockquote {
            font-style: italic;
            margin: 0 0 8px 0;
            color: var(--primary);
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .quote-section cite {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 500;
        }

        .help-text {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            font-size: 0.9rem;
            color: #1565c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌟 SereniTool</h1>
            <p>A comprehensive digital tool for auditing and reframing resentments, combining Step 4 inventory work and Step 9 amends from the AA Big Book with SMART Recovery principles.</p>
			<p>Overcome the bothersome with this guided process for everyone.  One needn't be addicted to replace anger with serenity, but doing so can help to maintain sobriety.</p>
        </div>

        <div class="privacy-notice">
            <h4>🔒 Privacy & Security</h4>
            <p>All data is stored locally on your device only. Nothing is sent to any server. Your inventory remains completely private and secure. Clear your browser data to permanently delete all entries.</p>
        </div>

        <div class="controls">
            <div class="filter-group">
                <label>Filter by Category:</label>
                <select id="categoryFilter">
                    <option value="">All Categories</option>
                    <option value="person">People</option>
                    <option value="institution">Institutions</option>
                    <option value="principle">Principles</option>
                </select>
            </div>

            <div class="filter-group">
                <label>Filter by Affects:</label>
                <select id="affectsFilter">
                    <option value="">All Areas</option>
                    <option value="self-esteem">Self-Esteem</option>
                    <option value="security">Security</option>
                    <option value="ambitions">Ambitions</option>
                    <option value="personal-relationships">Personal Relationships</option>
                    <option value="sex-relations">Sex Relations</option>
                    <option value="pride">Pride</option>
                    <option value="pocketbook">Financial</option>
                </select>
            </div>

            <div class="filter-group">
                <label>Search:</label>
                <input type="text" id="searchInput" placeholder="Search entries...">
            </div>

            <button class="btn btn-success" onclick="showAddModal()">
                ➕ Add New Entry
            </button>

            <button class="btn btn-warning" onclick="showExportModal()">
                📤 Export Data
            </button>

            <button class="btn" onclick="showImportModal()">
                📥 Import Data
            </button>

            <button class="btn btn-success" onclick="showPrayerListModal()">
                🙏 Prayer List
            </button>

            <button class="btn btn-danger" onclick="clearAllData()">
                🗑️ Clear All Data
            </button>
        </div>

        <div class="main-content">
            <div class="worksheet-section">
                <h2>Resentment Inventory</h2>
                <div id="entriesContainer">
                    <!-- Entries will be dynamically loaded here -->
                </div>
            </div>

            <div class="sidebar">
                <div class="progress-indicator">
                    <h3>Progress Tracker</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="totalEntries">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="completedEntries">0</div>
                            <div class="stat-label">Complete</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="amendsNeeded" style="color: var(--warning);">0</div>
                            <div class="stat-label">Amends Due</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="amendsComplete" style="color: var(--success);">0</div>
                            <div class="stat-label">Amends Done</div>
                        </div>
                    </div>
                </div>

                <div class="methodology-card">
                    <h3>📚 AA Big Book Method</h3>
                    <p><strong>Pages 64-67:</strong></p>
                    <ul>
                        <li>List people, institutions, principles</li>
                        <li>Identify what was threatened</li>
                        <li>Examine your part in it</li>
                        <li>Pray for those who hurt you</li>
                    </ul>
                </div>

                <div class="methodology-card">
                    <h3>📖 Literature Wisdom</h3>
                    <div class="quote-section">
                        <blockquote>
                            "Resentment is the 'number one' offender. It destroys more alcoholics than anything else."
                        </blockquote>
                        <cite>— Big Book, p. 64</cite>
                    </div>
                    
                    <div class="quote-section">
                        <blockquote>
                            "We realized that the people who wronged us were perhaps spiritually sick."
                        </blockquote>
                        <cite>— Big Book, p. 67</cite>
                    </div>
                    
                    <div class="quote-section">
                        <blockquote>
                            "If we were to live, we had to be free of anger. The grouch and the brainstorm were not for us."
                        </blockquote>
                        <cite>— Big Book, p. 66</cite>
                    </div>
                </div>

                <div class="smart-principles">
                    <h4>🧠 SMART Recovery Integration</h4>
                    <ul>
                        <li>Look for the hurt beneath resentment</li>
                        <li>Challenge irrational beliefs</li>
                        <li>Focus on what you can change</li>
                        <li>Practice emotional regulation</li>
                    </ul>
                </div>

                <div class="prayer-section">
                    <h3>🙏 Page 552 Prayer</h3>
                    <div class="prayer-text">
                        "If you have resentment you want to be free of, if you will pray for the person or thing that you resent, you will be free. Ask for their health, their prosperity, their happiness, and you will be free."
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Entry Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addModal')">&times;</span>
            <h2>Add New Resentment Entry</h2>
            
            <div class="tab-container">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('basic')">Basic Info</button>
                    <button class="tab-btn" onclick="switchTab('analysis')">Analysis</button>
                    <button class="tab-btn" onclick="switchTab('action')">Action Steps</button>
                </div>

                <div id="basic" class="tab-content active">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>I'm resentful at:</label>
                            <input type="text" id="resentfulAt" placeholder="Person, institution, or principle" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Category:</label>
                            <select id="category">
                                <option value="person">Person</option>
                                <option value="institution">Institution</option>
                                <option value="principle">Principle</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>The Cause (What happened?):</label>
                        <textarea id="cause" rows="3" placeholder="Describe what this person/institution/principle did..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>This affects my:</label>
                        <div class="help-text">
                            <strong>What gets affected:</strong> Self-Esteem (worth, confidence), Security (safety, stability), Ambitions (goals, dreams), Personal Relations (friendships, family), Sex Relations (intimate partnerships), Pride (ego, reputation), Financial (money, possessions)
                        </div>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="selfEsteem" value="self-esteem">
                                <label for="selfEsteem">Self-Esteem</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="security" value="security">
                                <label for="security">Security</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ambitions" value="ambitions">
                                <label for="ambitions">Ambitions</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="personalRel" value="personal-relationships">
                                <label for="personalRel">Personal Relations</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sexRel" value="sex-relations">
                                <label for="sexRel">Sex Relations</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pride" value="pride">
                                <label for="pride">Pride</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pocketbook" value="pocketbook">
                                <label for="pocketbook">Financial</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="analysis" class="tab-content">
                    <div class="form-group">
                        <label>My part in it (Where was I selfish, dishonest, self-seeking, or frightened?):</label>
                        <textarea id="myPart" rows="4" placeholder="Be honest about your role..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>What character defect was involved?</label>
						<div class="help-text">
                            <strong>Character Defects:</strong> Pride (arrogance or sense of superiority); Selfishness (self-centeredness, egotism); Fear (anxiety or apprehension); Dishonesty (deception, untruthfulness, or insincerity, lying, denial, or distortion of reality); Self-Seeking (pursuing self interest at the expense of others, or seeking self-gratification); Inconsideration (lack of thought or concern for others' feelings, needs, or well-being); Jealousy (resentful or suspicious feelings due to insecurity or fear); Envy (bitterness towards others' success, possessions, or qualities); Resentment (bitter or angry feelings from perceived injustice or hurt)
                        </div>
                        <select id="characterDefect">
                            <option value="">Select primary defect...</option>
                            <option value="pride">Pride</option>
                            <option value="selfishness">Selfishness</option>
                            <option value="fear">Fear</option>
                            <option value="dishonesty">Dishonesty</option>
                            <option value="self-seeking">Self-seeking</option>
                            <option value="inconsideration">Inconsideration</option>
                            <option value="jealousy">Jealousy</option>
                            <option value="envy">Envy</option>
                            <option value="resentment">Resentment</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>SMART Recovery: What hurt is underneath this resentment?</label>
                        <div class="help-text">
                            <strong>SMART Approach:</strong> Look for the hurt beneath resentment, challenge irrational beliefs, focus on what you can change, practice emotional regulation
                        </div>
                        <textarea id="underlyingHurt" rows="3" placeholder="What pain, fear, or unmet need is driving this resentment?"></textarea>
                    </div>
                </div>

                <div id="action" class="tab-content">
                    <div class="form-group">
                        <label>What should I have done differently?</label>
                        <textarea id="shouldHaveDone" rows="3" placeholder="How could you have handled this better?"></textarea>
                    </div>

                    <div class="form-group">
                        <label>What amends might be needed?</label>
                        <textarea id="amendsNeeded" rows="2" placeholder="Any direct or indirect amends required?"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Amends Status:</label>
                        <select id="amendsStatus">
                            <option value="not-applicable">Not Applicable</option>
                            <option value="pending">Amends Needed - Not Yet Made</option>
                            <option value="complete">Amends Made & Complete</option>
                        </select>
                    </div>

                    <div class="form-group" id="amendsCompleteDateGroup" style="display: none;">
                        <label>Date Amends Completed:</label>
                        <input type="date" id="amendsCompleteDate">
                    </div>

                    <div class="form-group">
                        <label>Prayer commitment (Page 552 method):</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="prayerCommitment">
                                <label for="prayerCommitment">I commit to praying for this person's health, prosperity, and happiness daily for 2 weeks</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="prayerCompleted">
                                <label for="prayerCompleted">I have completed my 2-week prayer commitment for this person</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Additional notes:</label>
                        <textarea id="notes" rows="3" placeholder="Any other thoughts or insights..."></textarea>
                    </div>
                </div>
            </div>

            <div style="text-align: right; margin-top: 20px;">
                <button class="btn" onclick="closeModal('addModal')">Cancel</button>
                <button class="btn btn-success" onclick="saveEntry()">Save Entry</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('exportModal')">&times;</span>
            <h2>Export Your Inventory</h2>
            <p>Choose your export format:</p>
            <div class="export-options">
                <button class="btn btn-success" onclick="exportToJSON()">📄 Export as JSON</button>
                <button class="btn btn-success" onclick="printInventory()">🖨️ Print Inventory</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('importModal')">&times;</span>
            <h2>Import Inventory Data</h2>
            <p>Select a JSON file exported from this application:</p>
            <input type="file" id="importFile" accept=".json" style="margin: 20px 0;">
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn" onclick="closeModal('importModal')">Cancel</button>
                <button class="btn btn-success" onclick="importData()">Import Data</button>
            </div>
        </div>
    </div>

    <!-- Prayer List Modal -->
    <div id="prayerListModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('prayerListModal')">&times;</span>
            <h2>🙏 Daily Prayer List</h2>
            <p>People you've committed to pray for (Page 552 method):</p>
            <div id="prayerListContent">
                <!-- Prayer list will be populated here -->
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-success" onclick="printPrayerList()">🖨️ Print Prayer List</button>
                <button class="btn" onclick="closeModal('prayerListModal')">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage and management
        let entries = JSON.parse(localStorage.getItem('resentmentEntries')) || [];
        let editingIndex = -1;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            renderEntries();
            updateStats();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('categoryFilter').addEventListener('change', filterEntries);
            document.getElementById('affectsFilter').addEventListener('change', filterEntries);
            document.getElementById('searchInput').addEventListener('input', filterEntries);
            
            // Add amends status change listener
            document.getElementById('amendsStatus').addEventListener('change', function() {
                const dateGroup = document.getElementById('amendsCompleteDateGroup');
                if (this.value === 'complete') {
                    dateGroup.style.display = 'block';
                    // Set today's date if not already set
                    const dateInput = document.getElementById('amendsCompleteDate');
                    if (!dateInput.value) {
                        dateInput.value = new Date().toISOString().split('T')[0];
                    }
                } else {
                    dateGroup.style.display = 'none';
                }
            });
        }

        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab and activate button
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function showAddModal() {
            document.getElementById('addModal').style.display = 'block';
            clearForm();
            editingIndex = -1;
        }

        function showExportModal() {
            document.getElementById('exportModal').style.display = 'block';
        }

        function showImportModal() {
            document.getElementById('importModal').style.display = 'block';
        }

        function showPrayerListModal() {
            document.getElementById('prayerListModal').style.display = 'block';
            loadPrayerList();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function clearForm() {
            document.getElementById('resentfulAt').value = '';
            document.getElementById('category').value = 'person';
            document.getElementById('cause').value = '';
            document.getElementById('myPart').value = '';
            document.getElementById('characterDefect').value = '';
            document.getElementById('underlyingHurt').value = '';
            document.getElementById('shouldHaveDone').value = '';
            document.getElementById('amendsNeeded').value = '';
            document.getElementById('amendsStatus').value = 'not-applicable';
            document.getElementById('amendsCompleteDate').value = '';
            document.getElementById('amendsCompleteDateGroup').style.display = 'none';
            document.getElementById('notes').value = '';
            
            // Clear checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            
            // Switch back to first tab
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('basic').classList.add('active');
            document.querySelector('.tab-btn').classList.add('active');
        }

        function saveEntry() {
            const entry = {
                id: Date.now(),
                resentfulAt: document.getElementById('resentfulAt').value,
                category: document.getElementById('category').value,
                cause: document.getElementById('cause').value,
                affects: getCheckedValues(),
                myPart: document.getElementById('myPart').value,
                characterDefect: document.getElementById('characterDefect').value,
                underlyingHurt: document.getElementById('underlyingHurt').value,
                shouldHaveDone: document.getElementById('shouldHaveDone').value,
                amendsNeeded: document.getElementById('amendsNeeded').value,
                amendsStatus: document.getElementById('amendsStatus').value,
                amendsCompleteDate: document.getElementById('amendsCompleteDate').value,
                prayerCommitment: document.getElementById('prayerCommitment').checked,
                prayerCompleted: document.getElementById('prayerCompleted').checked,
                notes: document.getElementById('notes').value,
                dateCreated: new Date().toISOString(),
                dateModified: new Date().toISOString()
            };

            if (!entry.resentfulAt.trim()) {
                alert('Please fill in who/what you are resentful at.');
                return;
            }

            if (editingIndex >= 0) {
                entries[editingIndex] = { ...entries[editingIndex], ...entry };
            } else {
                entries.push(entry);
            }

            localStorage.setItem('resentmentEntries', JSON.stringify(entries));
            renderEntries();
            updateStats();
            closeModal('addModal');
        }

        function getCheckedValues() {
            const checkboxes = ['selfEsteem', 'security', 'ambitions', 'personalRel', 'sexRel', 'pride', 'pocketbook'];
            return checkboxes.filter(id => document.getElementById(id).checked)
                           .map(id => document.getElementById(id).value);
        }

        function editEntry(index) {
            const entry = entries[index];
            editingIndex = index;
            
            // Fill form with entry data
            document.getElementById('resentfulAt').value = entry.resentfulAt;
            document.getElementById('category').value = entry.category;
            document.getElementById('cause').value = entry.cause || '';
            document.getElementById('myPart').value = entry.myPart || '';
            document.getElementById('characterDefect').value = entry.characterDefect || '';
            document.getElementById('underlyingHurt').value = entry.underlyingHurt || '';
            document.getElementById('shouldHaveDone').value = entry.shouldHaveDone || '';
            document.getElementById('amendsNeeded').value = entry.amendsNeeded || '';
            document.getElementById('amendsStatus').value = entry.amendsStatus || 'not-applicable';
            document.getElementById('amendsCompleteDate').value = entry.amendsCompleteDate || '';
            document.getElementById('notes').value = entry.notes || '';
            document.getElementById('prayerCommitment').checked = entry.prayerCommitment || false;
            document.getElementById('prayerCompleted').checked = entry.prayerCompleted || false;
            
            // Show/hide amends date field based on status
            const dateGroup = document.getElementById('amendsCompleteDateGroup');
            if (entry.amendsStatus === 'complete') {
                dateGroup.style.display = 'block';
            } else {
                dateGroup.style.display = 'none';
            }
            
            // Set checkboxes
            const checkboxMap = {
                'self-esteem': 'selfEsteem',
                'security': 'security',
                'ambitions': 'ambitions',
                'personal-relationships': 'personalRel',
                'sex-relations': 'sexRel',
                'pride': 'pride',
                'pocketbook': 'pocketbook'
            };
            
            // First clear all checkboxes
            Object.values(checkboxMap).forEach(checkboxId => {
                document.getElementById(checkboxId).checked = false;
            });
            
            // Then set the ones that should be checked
            (entry.affects || []).forEach(affect => {
                const checkboxId = checkboxMap[affect];
                if (checkboxId) {
                    document.getElementById(checkboxId).checked = true;
                }
            });
            
            // Show the modal
            document.getElementById('addModal').style.display = 'block';
        }

        function deleteEntry(index) {
            if (confirm('Are you sure you want to delete this entry?')) {
                entries.splice(index, 1);
                localStorage.setItem('resentmentEntries', JSON.stringify(entries));
                renderEntries();
                updateStats();
            }
        }

        function renderEntries() {
            const container = document.getElementById('entriesContainer');
            const filteredEntries = getFilteredEntries();
            
            if (filteredEntries.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <h3>No entries yet</h3>
                        <p>Click "Add New Entry" to begin your resentment inventory.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredEntries.map((entry, index) => `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-title">${escapeHtml(entry.resentfulAt)}</div>
                        <div class="entry-actions">
                            <button class="btn btn-sm btn-warning" onclick="editEntry(${entries.indexOf(entry)})">
                                ✏️ Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEntry(${entries.indexOf(entry)})">
                                🗑️ Delete
                            </button>
                        </div>
                    </div>
                    
                    <div class="entry-details">
                        <div class="detail-item">
                            <div class="detail-label">Category</div>
                            <div class="detail-value">${capitalizeFirst(entry.category)}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">Date Created</div>
                            <div class="detail-value">${formatDate(entry.dateCreated)}</div>
                        </div>
                        
                        ${entry.cause ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">The Cause</div>
                                <div class="detail-value">${escapeHtml(entry.cause)}</div>
                            </div>
                        ` : ''}
                        
                        ${entry.affects && entry.affects.length > 0 ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">Affects My</div>
                                <div class="affects-tags">
                                    ${entry.affects.map(affect => `<span class="tag">${formatAffect(affect)}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.myPart ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">My Part</div>
                                <div class="detail-value">${escapeHtml(entry.myPart)}</div>
                            </div>
                        ` : ''}
                        
                        ${entry.characterDefect ? `
                            <div class="detail-item">
                                <div class="detail-label">Character Defect</div>
                                <div class="detail-value">${capitalizeFirst(entry.characterDefect)}</div>
                            </div>
                        ` : ''}
                        
                        ${entry.underlyingHurt ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">Underlying Hurt (SMART)</div>
                                <div class="detail-value">${escapeHtml(entry.underlyingHurt)}</div>
                            </div>
                        ` : ''}
                        
                        ${entry.shouldHaveDone ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">What I Should Have Done</div>
                                <div class="detail-value">${escapeHtml(entry.shouldHaveDone)}</div>
                            </div>
                        ` : ''}
                        
                        ${entry.amendsNeeded ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">Amends Needed</div>
                                <div class="detail-value">${escapeHtml(entry.amendsNeeded)}</div>
                            </div>
                        ` : ''}
                        
                        ${entry.amendsStatus && entry.amendsStatus !== 'not-applicable' ? `
                            <div class="detail-item">
                                <div class="detail-label">Amends Status</div>
                                <div class="detail-value">
                                    <span class="amends-status ${getAmendsStatusClass(entry.amendsStatus)}">
                                        ${getAmendsStatusIcon(entry.amendsStatus)} ${getAmendsStatusText(entry.amendsStatus)}
                                        ${entry.amendsCompleteDate ? ` (${formatDate(entry.amendsCompleteDate)})` : ''}
                                    </span>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.prayerCommitment ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">Prayer Commitment</div>
                                <div class="detail-value">
                                    ✅ Committed to 2-week prayer practice
                                    ${entry.prayerCompleted ? ' | <span style="color: var(--success); font-weight: 600;">✅ Prayer Completed</span>' : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.notes ? `
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <div class="detail-label">Notes</div>
                                <div class="detail-value">${escapeHtml(entry.notes)}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getFilteredEntries() {
            let filtered = [...entries];
            
            const categoryFilter = document.getElementById('categoryFilter').value;
            const affectsFilter = document.getElementById('affectsFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (categoryFilter) {
                filtered = filtered.filter(entry => entry.category === categoryFilter);
            }
            
            if (affectsFilter) {
                filtered = filtered.filter(entry => 
                    entry.affects && entry.affects.includes(affectsFilter)
                );
            }
            
            if (searchTerm) {
                filtered = filtered.filter(entry => 
                    entry.resentfulAt.toLowerCase().includes(searchTerm) ||
                    (entry.cause && entry.cause.toLowerCase().includes(searchTerm)) ||
                    (entry.myPart && entry.myPart.toLowerCase().includes(searchTerm))
                );
            }
            
            return filtered.sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated));
        }

        function filterEntries() {
            renderEntries();
        }

        function updateStats() {
            const total = entries.length;
            const completed = entries.filter(entry => 
                entry.myPart && entry.myPart.trim() && 
                entry.shouldHaveDone && entry.shouldHaveDone.trim()
            ).length;
            
            // Add amends stats to the sidebar
            const amendsNeeded = entries.filter(entry => 
                entry.amendsStatus === 'pending'
            ).length;
            
            const amendsComplete = entries.filter(entry => 
                entry.amendsStatus === 'complete'
            ).length;
            
            document.getElementById('totalEntries').textContent = total;
            document.getElementById('completedEntries').textContent = completed;
            document.getElementById('amendsNeeded').textContent = amendsNeeded;
            document.getElementById('amendsComplete').textContent = amendsComplete;
            
            const percentage = total > 0 ? (completed / total) * 100 : 0;
            document.getElementById('progressFill').style.width = `${percentage}%`;
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL entries? This cannot be undone.')) {
                if (confirm('This will permanently delete your entire inventory. Are you absolutely sure?')) {
                    entries = [];
                    localStorage.removeItem('resentmentEntries');
                    renderEntries();
                    updateStats();
                }
            }
        }

        function exportToJSON() {
            const dataStr = JSON.stringify(entries, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `resentment-inventory-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            closeModal('exportModal');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedData)) {
                        throw new Error('Invalid file format');
                    }
                    
                    // Validate data structure
                    const validEntry = importedData.every(entry => 
                        entry.hasOwnProperty('resentfulAt') && 
                        entry.hasOwnProperty('dateCreated')
                    );
                    
                    if (!validEntry) {
                        throw new Error('Invalid data structure');
                    }
                    
                    if (confirm(`Import ${importedData.length} entries? This will add to your existing data.`)) {
                        // Add unique IDs to avoid conflicts
                        const processedData = importedData.map(entry => ({
                            ...entry,
                            id: Date.now() + Math.random(),
                            dateImported: new Date().toISOString()
                        }));
                        
                        entries = entries.concat(processedData);
                        localStorage.setItem('resentmentEntries', JSON.stringify(entries));
                        renderEntries();
                        updateStats();
                        closeModal('importModal');
                        
                        alert(`Successfully imported ${importedData.length} entries.`);
                    }
                    
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        function loadPrayerList() {
            const prayerEntries = entries.filter(entry => entry.prayerCommitment && !entry.prayerCompleted);
            const container = document.getElementById('prayerListContent');
            
            if (prayerEntries.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #6c757d;">
                        <p>No prayer commitments yet.</p>
                        <p>Check the "Prayer Commitment" box when adding entries to build your prayer list.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div style="background: #e3f2fd; padding: 20px; border-radius: 12px; margin-bottom: 25px; border-left: 5px solid #2196f3;">
                    <h4 style="margin: 0 0 15px 0; color: #1565c0; font-size: 1.2rem;">🙏 Page 552 Prayer Method</h4>
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p style="margin: 0 0 10px 0; font-style: italic; font-size: 1.05rem; color: #333;">
                            <strong>"If you have resentment you want to be free of, if you will pray for the person or thing that you resent, you will be free. Ask for their health, their prosperity, their happiness, and you will be free."</strong>
                        </p>
                        <p style="margin: 0; color: #666; font-size: 0.95rem;">— Big Book, Page 552</p>
                    </div>
                    
                    <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="margin: 0 0 10px 0; color: #e65100;">📋 Daily Practice Instructions:</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #bf360c;">
                            <li>Pray for each person below daily for 2 weeks minimum</li>
                            <li>Ask for their health, prosperity, and happiness specifically</li>
                            <li>Even if you don't mean it at first, keep doing it</li>
                            <li>You will find you come to mean it and feel free</li>
                        </ul>
                    </div>
                    
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px;">
                        <h5 style="margin: 0 0 10px 0; color: #7b1fa2;">🧘 Meditation Integration (SMART):</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #4a148c;">
                            <li>Focus on the hurt beneath your resentment during prayer</li>
                            <li>Practice compassion for their spiritual sickness</li>
                            <li>Visualize them as healthy, happy, and prosperous</li>
                            <li>Notice your emotional shift from anger to peace</li>
                        </ul>
                    </div>
                </div>
                
                ${prayerEntries.map((entry, index) => `
                    <div style="background: white; padding: 20px; margin: 15px 0; border-radius: 12px; border-left: 4px solid var(--secondary); box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px;">
                            <h4 style="margin: 0 0 8px 0; color: var(--primary); font-size: 1.3rem;">
                                ${escapeHtml(entry.resentfulAt)}
                            </h4>
                            <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">
                                <strong>Category:</strong> ${capitalizeFirst(entry.category)} | 
                                <strong>Added:</strong> ${formatDate(entry.dateCreated)}
                            </div>
                        </div>
                        
                        ${entry.cause ? `
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; color: #555; font-size: 0.9rem; margin-bottom: 5px;">THE CAUSE:</div>
                                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; font-size: 0.95rem;">
                                    ${escapeHtml(entry.cause)}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.affects && entry.affects.length > 0 ? `
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; color: #555; font-size: 0.9rem; margin-bottom: 5px;">AFFECTS MY:</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                    ${entry.affects.map(affect => `<span style="background: var(--secondary); color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">${formatAffect(affect)}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.myPart ? `
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; color: #555; font-size: 0.9rem; margin-bottom: 5px;">MY PART:</div>
                                <div style="background: #fff3cd; padding: 10px; border-radius: 6px; font-size: 0.95rem; border-left: 3px solid #ffc107;">
                                    ${escapeHtml(entry.myPart)}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.underlyingHurt ? `
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; color: #555; font-size: 0.9rem; margin-bottom: 5px;">UNDERLYING HURT (SMART):</div>
                                <div style="background: #f3e5f5; padding: 10px; border-radius: 6px; font-size: 0.95rem; border-left: 3px solid #e91e63;">
                                    ${escapeHtml(entry.underlyingHurt)}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.characterDefect ? `
                            <div style="margin-bottom: 12px;">
                                <div style="font-weight: 600; color: #555; font-size: 0.9rem; margin-bottom: 5px;">CHARACTER DEFECT:</div>
                                <div style="display: inline-block; background: #ffebee; color: #c62828; padding: 6px 12px; border-radius: 15px; font-size: 0.9rem; font-weight: 600;">
                                    ${capitalizeFirst(entry.characterDefect)}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 3px solid #4caf50; margin-top: 15px;">
                            <div style="font-weight: 600; color: #2e7d32; font-size: 0.95rem; margin-bottom: 8px;">
                                🙏 PRAYER FOCUS FOR THIS PERSON:
                            </div>
                            <div style="font-style: italic; color: #388e3c; font-size: 0.9rem; line-height: 1.4;">
                                "God, help me show <strong>${escapeHtml(entry.resentfulAt)}</strong> the same tolerance, pity, and patience that I would cheerfully grant a sick friend. Please grant them health, prosperity, and happiness. Help me to be helpful to them rather than angry."
                            </div>
                        </div>
                        
                        ${entry.notes ? `
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
                                <div style="font-weight: 600; color: #555; font-size: 0.9rem; margin-bottom: 5px;">NOTES:</div>
                                <div style="font-size: 0.95rem; color: #666; font-style: italic;">
                                    ${escapeHtml(entry.notes)}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `).join('')}
            `;
        }

        function printPrayerList() {
            const prayerEntries = entries.filter(entry => entry.prayerCommitment);
            
            if (prayerEntries.length === 0) {
                alert('No prayer commitments to print.');
                return;
            }
            
            const printContent = `
                <html>
                <head>
                    <title>Prayer List - ${new Date().toLocaleDateString()}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                        .prayer-method { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; }
                        .prayer-item { margin: 15px 0; padding: 12px; border: 1px solid #ddd; border-radius: 6px; }
                        .name { font-weight: bold; color: #2c3e50; margin-bottom: 8px; }
                        .date { font-size: 0.9rem; color: #666; }
                        .cause { font-size: 0.9rem; margin-top: 8px; }
                    </style>
                </head>
                <body>
                    <h1>🙏 Daily Prayer List</h1>
                    <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}</p>
                    
                    <div class="prayer-method">
                        <h3>Page 552 Prayer Method</h3>
                        <p><em>"If you have resentment you want to be free of, if you will pray for the person or thing that you resent, you will be free. Ask for their health, their prosperity, their happiness, and you will be free."</em></p>
                        <p><strong>Instructions:</strong> Pray daily for each person below for 2 weeks.</p>
                        <h4>Sample Prayer for Each Person:</h4>
                        <p style="font-style: italic; background: #f0f8ff; padding: 10px; border-radius: 5px;">"God, help me show [Name] the same tolerance, pity, and patience that I would cheerfully grant a sick friend. Please grant them health, prosperity, and happiness. Help me to be helpful to them rather than angry."</p>
                    </div>
                    
                    ${prayerEntries.map(entry => `
                        <div class="prayer-item">
                            <div class="name">${escapeHtml(entry.resentfulAt)} (${capitalizeFirst(entry.category)})</div>
                            <div class="date">Added: ${formatDate(entry.dateCreated)}</div>
                            ${entry.cause ? `<div class="cause"><strong>The Cause:</strong> ${escapeHtml(entry.cause)}</div>` : ''}
                            ${entry.affects && entry.affects.length > 0 ? `<div class="cause"><strong>Affects My:</strong> ${entry.affects.map(formatAffect).join(', ')}</div>` : ''}
                            ${entry.myPart ? `<div class="cause"><strong>My Part:</strong> ${escapeHtml(entry.myPart)}</div>` : ''}
                            ${entry.underlyingHurt ? `<div class="cause"><strong>Underlying Hurt:</strong> ${escapeHtml(entry.underlyingHurt)}</div>` : ''}
                            ${entry.characterDefect ? `<div class="cause"><strong>Character Defect:</strong> ${capitalizeFirst(entry.characterDefect)}</div>` : ''}
                            ${entry.notes ? `<div class="cause"><strong>Notes:</strong> ${escapeHtml(entry.notes)}</div>` : ''}
                            <div style="background: #e8f5e8; padding: 10px; margin-top: 10px; border-radius: 5px; border-left: 3px solid #4caf50;">
                                <strong>Prayer Focus:</strong> <em>Ask God for ${escapeHtml(entry.resentfulAt)}'s health, prosperity, and happiness. Show them tolerance, pity, and patience.</em>
                            </div>
                        </div>
                    `).join('')}
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        function printInventory() {
            const printContent = `
                <html>
                <head>
                    <title>Resentment Inventory - ${new Date().toLocaleDateString()}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                        .entry { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                        .entry-title { font-size: 1.2em; font-weight: bold; color: #2c3e50; margin-bottom: 10px; }
                        .detail { margin: 8px 0; }
                        .label { font-weight: bold; color: #555; }
                        .affects { display: inline-block; background: #3498db; color: white; padding: 2px 8px; margin: 2px; border-radius: 12px; font-size: 0.8em; }
                        @media print { .entry { break-inside: avoid; } }
                    </style>
                </head>
                <body>
                    <h1>Resentment Inventory</h1>
                    <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}</p>
                    <p><strong>Total Entries:</strong> ${entries.length}</p>
                    <hr>
                    ${entries.map(entry => `
                        <div class="entry">
                            <div class="entry-title">${escapeHtml(entry.resentfulAt)} (${capitalizeFirst(entry.category)})</div>
                            ${entry.cause ? `<div class="detail"><span class="label">The Cause:</span> ${escapeHtml(entry.cause)}</div>` : ''}
                            ${entry.affects && entry.affects.length > 0 ? `
                                <div class="detail">
                                    <span class="label">Affects My:</span> 
                                    ${entry.affects.map(affect => `<span class="affects">${formatAffect(affect)}</span>`).join('')}
                                </div>
                            ` : ''}
                            ${entry.myPart ? `<div class="detail"><span class="label">My Part:</span> ${escapeHtml(entry.myPart)}</div>` : ''}
                            ${entry.characterDefect ? `<div class="detail"><span class="label">Character Defect:</span> ${capitalizeFirst(entry.characterDefect)}</div>` : ''}
                            ${entry.underlyingHurt ? `<div class="detail"><span class="label">Underlying Hurt:</span> ${escapeHtml(entry.underlyingHurt)}</div>` : ''}
                            ${entry.shouldHaveDone ? `<div class="detail"><span class="label">Should Have Done:</span> ${escapeHtml(entry.shouldHaveDone)}</div>` : ''}
                            ${entry.amendsNeeded ? `<div class="detail"><span class="label">Amends Needed:</span> ${escapeHtml(entry.amendsNeeded)}</div>` : ''}
                            ${entry.amendsStatus && entry.amendsStatus !== 'not-applicable' ? `
                                <div class="detail">
                                    <span class="label">Amends Status:</span> 
                                    ${getAmendsStatusText(entry.amendsStatus)}
                                    ${entry.amendsCompleteDate ? ` (Completed: ${formatDate(entry.amendsCompleteDate)})` : ''}
                                </div>
                            ` : ''}
                            ${entry.prayerCommitment ? `<div class="detail"><span class="label">Prayer Commitment:</span> ✓ Committed to 2-week prayer practice</div>` : ''}
                            ${entry.notes ? `<div class="detail"><span class="label">Notes:</span> ${escapeHtml(entry.notes)}</div>` : ''}
                            <div class="detail"><span class="label">Date:</span> ${formatDate(entry.dateCreated)}</div>
                        </div>
                    `).join('')}
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
            
            closeModal('exportModal');
        }

        function togglePrayerCompletion(index) {
            const entry = entries[index];
            entry.prayerCompleted = !entry.prayerCompleted;
            localStorage.setItem('resentmentEntries', JSON.stringify(entries));
            loadPrayerList(); // Refresh the prayer list display
        }

        // Utility functions
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function capitalizeFirst(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            return new Date(dateString).toLocaleDateString();
        }

        function formatAffect(affect) {
            const mapping = {
                'self-esteem': 'Self-Esteem',
                'security': 'Security',
                'ambitions': 'Ambitions',
                'personal-relationships': 'Personal Relations',
                'sex-relations': 'Sex Relations',
                'pride': 'Pride',
                'pocketbook': 'Financial'
            };
            return mapping[affect] || affect;
        }

        function getAmendsStatusClass(status) {
            switch(status) {
                case 'pending': return 'amends-pending';
                case 'complete': return 'amends-complete';
                default: return 'amends-na';
            }
        }

        function getAmendsStatusIcon(status) {
            switch(status) {
                case 'pending': return '⏳';
                case 'complete': return '✅';
                default: return '➖';
            }
        }

        function getAmendsStatusText(status) {
            switch(status) {
                case 'pending': return 'Amends Pending';
                case 'complete': return 'Amends Complete';
                default: return 'Not Applicable';
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                showAddModal();
            }
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                showExportModal();
            }
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });

        // Auto-save draft functionality (only save if not editing existing entry)
        let draftTimer;
        function saveDraft() {
            // Don't save draft if we're editing an existing entry
            if (editingIndex >= 0) {
                return;
            }
            
            const draft = {
                resentfulAt: document.getElementById('resentfulAt').value,
                category: document.getElementById('category').value,
                cause: document.getElementById('cause').value,
                myPart: document.getElementById('myPart').value,
                characterDefect: document.getElementById('characterDefect').value,
                underlyingHurt: document.getElementById('underlyingHurt').value,
                shouldHaveDone: document.getElementById('shouldHaveDone').value,
                amendsNeeded: document.getElementById('amendsNeeded').value,
                amendsStatus: document.getElementById('amendsStatus').value,
                amendsCompleteDate: document.getElementById('amendsCompleteDate').value,
                notes: document.getElementById('notes').value,
                affects: getCheckedValues(),
                prayerCommitment: document.getElementById('prayerCommitment').checked
            };
            localStorage.setItem('resentmentDraft', JSON.stringify(draft));
        }

        function loadDraft() {
            const draft = localStorage.getItem('resentmentDraft');
            if (draft && editingIndex === -1) {
                const draftData = JSON.parse(draft);
                if (draftData.resentfulAt || draftData.cause) {
                    if (confirm('You have an unsaved draft. Would you like to load it?')) {
                        // Load draft data into form
                        Object.keys(draftData).forEach(key => {
                            if (key === 'affects') {
                                const checkboxMap = {
                                    'self-esteem': 'selfEsteem',
                                    'security': 'security',
                                    'ambitions': 'ambitions',
                                    'personal-relationships': 'personalRel',
                                    'sex-relations': 'sexRel',
                                    'pride': 'pride',
                                    'pocketbook': 'pocketbook'
                                };
                                draftData.affects.forEach(affect => {
                                    const checkboxId = checkboxMap[affect];
                                    if (checkboxId) {
                                        document.getElementById(checkboxId).checked = true;
                                    }
                                });
                            } else if (key === 'prayerCommitment') {
                                document.getElementById(key).checked = draftData[key];
                            } else if (key === 'amendsStatus') {
                                document.getElementById(key).value = draftData[key];
                                // Trigger change event to show/hide date field
                                document.getElementById(key).dispatchEvent(new Event('change'));
                            } else {
                                const element = document.getElementById(key);
                                if (element) element.value = draftData[key];
                            }
                        });
                    }
                }
            }
        }

        // Auto-save every 2 seconds when modal is open (only for new entries)
        document.getElementById('addModal').addEventListener('input', function() {
            // Only auto-save if we're not editing an existing entry
            if (editingIndex === -1) {
                clearTimeout(draftTimer);
                draftTimer = setTimeout(saveDraft, 2000);
            }
        });

        // Clear draft when entry is saved
        function clearDraft() {
            localStorage.removeItem('resentmentDraft');
        }
    </script>
</body>
</html>